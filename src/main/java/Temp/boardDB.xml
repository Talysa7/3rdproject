<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
<!--
	FIXME : albumDB.xml에 동일한 메서드 존재함
	한쪽만 존재한다면 albumDB 쪽이 더 어울리지 않나 싶어 주석
	<select id="getThumbail" parameterType="String" resultType="String">
		select photo_url from pao_thumbnail where b_id=#{b_id}
	</select> 
-->
	<select id="getBoardTags" parameterType="int" resultType="java.util.List">
		select tag_value from pao_tag where tag_id in
		(select tag_id from pao_trip_tag where b_no=#{b_no})
	</select>
	
	<!--/////////////////////////////////////////////////// start-line pao_comment table ///////////////////////////////////////////////////-->
	<!-- FIXME : Temp 합치고 난 후에 parameterType 등의 Temp. 어쩌구 전부 교체 필요함 -->
	<insert id="insertComment" parameterType="Temp.CmtDataBean">
		INSERT INTO pao_comment(comment_content, comment_reg_date, board_no, user_id)
		VALUES( #{comment_content, jdbcType=VARCHAR}, SYSDATE, #{board_no}, #{user_id} )
	</insert>
	<update id="updateComment" parameterType="Temp.CmtDataBean">
		UPDATE pao_comment 
		SET	comment_content = #{comment_content} 
		WHERE comment_id = #{comment_id}
	</update>
	<delete id="deleteComment" parameterType="int">
		DELETE FROM pao_comment
		WHERE comment_id = #{comment_id}
	</delete>
	<select id="getCmtCount" resultType="int">
		SELECT count(*) 
		FROM pao_comment
	</select>
	<select id="getComment" parameterType="int" resultType="Temp.CmtDataBean">
		SELECT * 
		FROM pao_comment 
		WHERE board_no=#{board_no} 
		ORDER BY comment_id DESC
	</select>
	<select id="getComments" parameterType="java.util.Map" resultType="Temp.CmtDataBean">
		SELECT comment_id,board_no,user_id,comment_content,comment_reg_date,r
		FROM (
			SELECT comment_id,board_no,user_id,comment_content,comment_reg_date,rownum r 
			FROM (
				SELECT comment_id,board_no,user_id,comment_content,comment_reg_date 
				FROM pao_comment 
				ORDER BY comment_reg_date DESC
				)
			ORDER BY comment_reg_date DESC)
		WHERE r &gt;= #{start} 
		AND r &lt;= #{end}
	</select>
	<!--/////////////////////////////////////////////////// end-line pao_comment table ///////////////////////////////////////////////////-->
</mapper>